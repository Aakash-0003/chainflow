generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum chain_status {
  active
  disabled
}

enum wallet_status {
  active
  paused
  disabled
}

enum transaction_status {
  queued
  processing
  sent
  mined
  failed
  errored
}

model Chain {
  chainId     Int          @id @map("chain_id")
  name        String
  rpcUrl      String       @map("rpc_url")
  nativeToken String       @map("native_token")
  status      chain_status @default(active)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  wallet_chains WalletChain[]
  transactions  Transaction[]

  @@map("chains")
}

model Wallet {
  id            String @id @default(uuid())
  name          String @unique
  publicAddress String @unique @map("public_address")

  encryptedSecret String @map("encrypted_secret")
  encryptedIv     String @map("encrypted_iv")
  encryptionAuth  String @map("encryption_auth")

  status    wallet_status @default(active)
  createdAt DateTime      @default(now()) @map("created_at")
  updatedAt DateTime      @updatedAt @map("updated_at")

  wallet_chains WalletChain[]
  transactions  Transaction[]

  @@map("wallets")
}

model WalletChain {
  walletId String @map("wallet_id")
  chainId  Int    @map("chain_id")

  wallet    Wallet       @relation(fields: [walletId], references: [id])
  chain     Chain        @relation(fields: [chainId], references: [chainId])
  status    chain_status @default(active)
  createdAt DateTime     @default(now()) @map("created_at")

  @@id([walletId, chainId])
  @@index([walletId])
  @@index([chainId])
  @@map("wallet_chain")
}

model Transaction {
  id              String             @id @default(uuid())
  transactionHash String?            @map("transaction_hash")
  blockNumber     BigInt?            @map("block_number")
  walletId        String             @map("wallet_id")
  chainId         Int                @map("chain_id")
  toAddress       String             @map("to_address")
  value           BigInt?
  data            String?
  nonce           BigInt?
  // gas_limit BigInt?
  // gas_price BigInt?        
  // max_fee_per_gas BigInt?  
  // max_priority_fee BigInt?
  status          transaction_status @default(queued)
  retryCount      Int                @default(0) @map("retry_count")

  submittedAt DateTime? @map("submitted_at")
  confirmedAt DateTime? @map("confirmed_at")
  createdAt   DateTime  @default(now()) @map("created_at")

  wallet Wallet @relation(fields: [walletId], references: [id])
  chain  Chain  @relation(fields: [chainId], references: [chainId])

  @@map("transactions")
}
